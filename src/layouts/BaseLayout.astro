---
import { site } from '../data/site';
import { scriptBundles } from '../data/scripts';
import Preloader from '../components/layout/Preloader.astro';
import SiteHeader from '../components/layout/SiteHeader.astro';
import MobileMenu from '../components/layout/MobileMenu.astro';
import SearchModal from '../components/layout/SearchModal.astro';
import SiteFooter from '../components/layout/SiteFooter.astro';
import ScrollToTop from '../components/layout/ScrollToTop.astro';
import SiteScripts from '../components/layout/SiteScripts.astro';
import Breadcrumb from '../components/layout/Breadcrumb.astro';

const {
  title = site.metaTitle,
  description = site.description,
  canonical,
  image = site.ogImage,
  noindex = false,
  pageType = 'website',
  scripts = scriptBundles.standard,
  breadcrumb
} = Astro.props;

const canonicalUrl = new URL(canonical ?? Astro.url.pathname, site.url).toString();
const ogImageUrl = image.startsWith('http') ? image : new URL(image, site.url).toString();
const robots = noindex ? 'noindex, nofollow' : 'index, follow';
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: site.author,
  url: site.url,
  jobTitle: site.role,
  image: ogImageUrl,
  sameAs: site.socials.filter(Boolean),
  email: site.email,
  telephone: site.phone,
  contactPoint: [
    {
      '@type': 'ContactPoint',
      contactType: 'customer support',
      email: site.email,
      telephone: site.phone,
      areaServed: 'Worldwide',
      availableLanguage: ['en']
    }
  ],
  worksFor: {
    '@type': 'Organization',
    name: site.name
  }
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="author" content={site.author} />
    <meta name="keywords" content={site.keywords} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={pageType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content={site.name} />
    <meta property="og:image" content={ogImageUrl} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />

    <meta name="theme-color" content={site.themeColor} />

    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.webmanifest" />

    <link rel="preload" href="/assets/css/plugins.css" as="style" />
    <link rel="preload" href="/assets/css/style.css" as="style" />
    <link rel="stylesheet" href="/assets/css/plugins.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />

    <script type="application/ld+json">{JSON.stringify(structuredData)}</script>
  </head>
  <body id="top">
    <Preloader />
    <SiteHeader />
    <MobileMenu />
    <SearchModal />
    <main>
      {breadcrumb && <Breadcrumb {...breadcrumb} />}
      <slot />
    </main>
    <script is:inline src="/assets/js/portfolio-animations.js"></script>
    <SiteFooter />
    <ScrollToTop />
    <SiteScripts scripts={scripts} />
  </body>
</html>
